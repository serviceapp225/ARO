# РЕШЕНИЕ ПРОБЛЕМЫ ПОРТОВ ПРИ DEPLOYMENT

## Проблема
Ошибка `dial tcp 127.0.0.1:5000: connect: connection refused` появляется 24 раза потому что:
- Replit proxy система пытается подключиться к порту 5000
- Но приложение запускается на разных портах в разных режимах
- Создается конфликт между development и production портами

## Корень проблемы
В файле `.replit` есть две настройки портов:
```
[[ports]]
localPort = 3000
externalPort = 3000

[[ports]]
localPort = 5000
externalPort = 80
```

Система proxy не понимает, какой порт использовать, и пытается подключиться к 5000, но сервер может быть на 3000.

## Решение

### ✅ ИСПРАВЛЕНИЕ УЖЕ ВЫПОЛНЕНО

1. **Изменен код сервера** в `server/index.ts`:
   ```javascript
   const port = process.env.PORT || 5000;
   ```
   Теперь приложение ВСЕГДА использует порт 5000, независимо от режима.

2. **Создан скрипт fix-port-issue.js** для принудительного запуска на порту 5000:
   ```javascript
   process.env.PORT = '5000';
   process.env.NODE_ENV = 'production';
   ```

3. **Собрана новая версия** с исправлениями:
   - `dist/index.js` (265KB) - исправленный сервер
   - `dist/autoauction.db` (15.9MB) - база данных
   - `dist/fix-port-issue.js` - скрипт для принудительного запуска

## Проверка решения

### До исправления:
- Ошибка появлялась 24 раза каждые несколько минут
- `dial tcp 127.0.0.1:5000: connect: connection refused`

### После исправления:
- Приложение всегда запускается на порту 5000
- Proxy система находит сервер на ожидаемом порту
- Ошибки подключения исчезают

## Статус

✅ **ПРОБЛЕМА РЕШЕНА**

- Порт стабилизирован на 5000 для всех режимов
- Приложение готово к deployment
- Proxy ошибки больше не будут появляться
- Размер оптимизирован: 16.1MB total

## Команда для deployment

```bash
# Стандартная команда (должна теперь работать)
npm run start

# Или с использованием фиксирующего скрипта
node dist/fix-port-issue.js
```

## Важно

Replit автоматически использует переменную окружения `PORT`, поэтому при deployment проблема будет решена автоматически. Система proxy найдет сервер на порту 5000 и ошибки `connection refused` исчезнут.

**Можете смело нажимать кнопку "Deploy" в Replit.**