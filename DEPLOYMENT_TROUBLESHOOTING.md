# Deployment Troubleshooting - DigitalOcean (–ê–≤–≥—É—Å—Ç 2025)

## –ü—Ä–æ–±–ª–µ–º–∞ Health Check
```
ERROR failed health checks after 16 attempts with error Readiness probe failed: 
dial tcp 10.244.209.135:8080: connect: connection refused
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –°–æ–∑–¥–∞–Ω –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –°–µ—Ä–≤–µ—Ä
–°–æ–∑–¥–∞–Ω `server/production-minimal.ts` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º Express —Å–µ—Ä–≤–µ—Ä–æ–º:
- –¢–æ–ª—å–∫–æ health check endpoint
- –ë–∞–∑–æ–≤–∞—è –∫–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞  
- –ë–µ–∑ —Å–ª–æ–∂–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
- –ë–µ–∑ WebSocket –∏ —Ç—è–∂–µ–ª—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. –í–æ–∑–º–æ–∂–Ω—ã–µ –ü—Ä–∏—á–∏–Ω—ã

#### A. –ü—Ä–æ–±–ª–µ–º—ã —Å Dependencies
- Runtime –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ production stage
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π Node.js –º–µ–∂–¥—É builder –∏ production

#### B. –ü—Ä–æ–±–ª–µ–º—ã —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö  
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### C. –ü—Ä–æ–±–ª–µ–º—ã —Å –ü–æ—Ä—Ç–æ–º
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

#### D. Crash –ø—Ä–∏ –°—Ç–∞—Ä—Ç–µ
- –û—à–∏–±–∫–∏ –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö –º–æ–¥—É–ª–µ–π
- –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ

### 3. –ü–ª–∞–Ω –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –≠—Ç–∞–ø 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –°–µ—Ä–≤–µ—Ä
```dockerfile
# –ò–∑–º–µ–Ω–∏—Ç—å –≤ Dockerfile:
RUN npx esbuild server/production-minimal.ts --platform=node --packages=external --bundle --format=esm --outfile=dist/production.js
```

#### –≠—Ç–∞–ø 2: –ï—Å–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç
–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å:
1. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
2. API —Ä–æ—É—Ç—ã (–±–µ–∑ –ë–î)
3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
4. WebSocket

#### –≠—Ç–∞–ø 3: –ï—Å–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –ë–∞–∑–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. Node.js runtime
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 4. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ö–æ–º–∞–Ω–¥—ã

#### –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç Docker
```bash
docker build -t autobid-minimal .
docker run -p 8080:8080 -e NODE_ENV=production autobid-minimal
curl http://localhost:8080/health
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ DigitalOcean
```bash
doctl apps logs <app-id> --follow
```

### 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
```env
NODE_ENV=production
PORT=8080
```

–ü–æ–ª–Ω—ã–µ:
```env
NODE_ENV=production
PORT=8080
DATABASE_URL=postgresql://user:pass@host:port/db
SESSION_SECRET=test-secret
```

## –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–¢–µ—Å—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞** - –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å–ª–æ–∂–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤** - —Ç–æ—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ crash –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π** - –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∫–æ–¥–∞

## –°—Ç–∞—Ç—É—Å
üîç **–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê** - –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã.