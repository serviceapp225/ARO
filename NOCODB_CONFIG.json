{
  "version": "1.0.0",
  "project": {
    "title": "AutoBid Admin Panel",
    "description": "Административная панель для управления автоаукционом AutoBid"
  },
  "database": {
    "client": "postgresql",
    "connection": {
      "host": "ep-broad-shadow-adb94hwu.c-2.us-east-1.aws.neon.tech",
      "port": 5432,
      "database": "neondb", 
      "user": "neondb_owner",
      "ssl": {"require": true}
    }
  },
  "tables": {
    "users": {
      "views": [
        {
          "name": "Все пользователи",
          "type": "grid",
          "columns": ["id", "username", "phone_number", "full_name", "is_active", "role", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "filters": [],
          "group_by": ["role"]
        },
        {
          "name": "Неактивные пользователи",
          "type": "grid", 
          "columns": ["id", "username", "phone_number", "full_name", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "filters": [{"field": "is_active", "operator": "eq", "value": false}]
        },
        {
          "name": "Новые регистрации",
          "type": "grid",
          "columns": ["id", "username", "phone_number", "full_name", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "filters": [{"field": "created_at", "operator": "gte", "value": "last_7_days"}]
        }
      ],
      "forms": {
        "edit": {
          "title": "Редактировать пользователя",
          "fields": [
            {"name": "full_name", "required": false, "type": "text"},
            {"name": "is_active", "required": true, "type": "checkbox"},
            {"name": "role", "required": true, "type": "select", "options": ["buyer", "seller", "admin"]}
          ],
          "readonly_fields": ["id", "username", "phone_number", "created_at"]
        }
      },
      "display_value": "username"
    },
    "car_listings": {
      "views": [
        {
          "name": "Все объявления",
          "type": "grid",
          "columns": ["id", "lot_number", "make", "model", "year", "starting_price", "current_bid", "status", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "group_by": ["status"],
          "color_mapping": {
            "status": {
              "pending": "#f59e0b",
              "active": "#10b981", 
              "ended": "#6b7280",
              "rejected": "#ef4444"
            }
          }
        },
        {
          "name": "На модерации",
          "type": "grid",
          "columns": ["id", "lot_number", "make", "model", "year", "starting_price", "seller_id", "created_at"],
          "sort": [{"field": "created_at", "direction": "asc"}],
          "filters": [{"field": "status", "operator": "eq", "value": "pending"}]
        },
        {
          "name": "Активные аукционы", 
          "type": "grid",
          "columns": ["id", "lot_number", "make", "model", "current_bid", "auction_end_time"],
          "sort": [{"field": "auction_end_time", "direction": "asc"}],
          "filters": [{"field": "status", "operator": "eq", "value": "active"}]
        },
        {
          "name": "Завершенные продажи",
          "type": "grid", 
          "columns": ["id", "lot_number", "make", "model", "current_bid", "auction_end_time"],
          "sort": [{"field": "auction_end_time", "direction": "desc"}],
          "filters": [{"field": "status", "operator": "eq", "value": "ended"}]
        }
      ],
      "forms": {
        "edit": {
          "title": "Модерация объявления",
          "fields": [
            {"name": "status", "required": true, "type": "select", "options": ["pending", "active", "ended", "rejected"]},
            {"name": "starting_price", "required": true, "type": "currency"},
            {"name": "current_bid", "required": false, "type": "currency"},
            {"name": "auction_duration", "required": true, "type": "number"}
          ],
          "readonly_fields": ["id", "seller_id", "lot_number", "make", "model", "year", "created_at"]
        }
      },
      "display_value": "lot_number",
      "lookup_columns": ["seller_id"]
    },
    "bids": {
      "views": [
        {
          "name": "Все ставки",
          "type": "grid",
          "columns": ["id", "listing_id", "bidder_id", "amount", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "lookup_columns": ["listing_id", "bidder_id"]
        },
        {
          "name": "Последние ставки",
          "type": "grid",
          "columns": ["listing_id", "bidder_id", "amount", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "filters": [{"field": "created_at", "operator": "gte", "value": "last_24_hours"}]
        }
      ],
      "lookup_columns": {
        "listing_id": {
          "table": "car_listings",
          "display_column": "lot_number"
        },
        "bidder_id": {
          "table": "users", 
          "display_column": "username"
        }
      }
    },
    "notifications": {
      "views": [
        {
          "name": "Все уведомления",
          "type": "grid",
          "columns": ["id", "user_id", "type", "title", "message", "is_read", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}]
        },
        {
          "name": "Непрочитанные",
          "type": "grid",
          "columns": ["user_id", "type", "title", "message", "created_at"],
          "sort": [{"field": "created_at", "direction": "desc"}],
          "filters": [{"field": "is_read", "operator": "eq", "value": false}]
        }
      ],
      "forms": {
        "create": {
          "title": "Создать уведомление",
          "fields": [
            {"name": "user_id", "required": true, "type": "lookup"},
            {"name": "type", "required": true, "type": "select", "options": ["system", "bid_update", "auction_ending", "car_found"]},
            {"name": "title", "required": true, "type": "text"},
            {"name": "message", "required": true, "type": "textarea"},
            {"name": "listing_id", "required": false, "type": "lookup"}
          ]
        }
      }
    }
  },
  "dashboard": {
    "widgets": [
      {
        "type": "stat",
        "title": "Ожидающие модерации",
        "query": "SELECT COUNT(*) as count FROM car_listings WHERE status = 'pending'",
        "color": "#f59e0b",
        "icon": "clock"
      },
      {
        "type": "stat", 
        "title": "Активные аукционы",
        "query": "SELECT COUNT(*) as count FROM car_listings WHERE status = 'active'",
        "color": "#10b981",
        "icon": "trending-up"
      },
      {
        "type": "stat",
        "title": "Всего пользователей", 
        "query": "SELECT COUNT(*) as count FROM users",
        "color": "#3b82f6",
        "icon": "users"
      },
      {
        "type": "stat",
        "title": "Неактивные пользователи",
        "query": "SELECT COUNT(*) as count FROM users WHERE is_active = false",
        "color": "#ef4444", 
        "icon": "user-x"
      },
      {
        "type": "chart",
        "title": "Регистрации по дням",
        "chart_type": "line",
        "query": "SELECT DATE(created_at) as date, COUNT(*) as registrations FROM users WHERE created_at >= CURRENT_DATE - INTERVAL '30 days' GROUP BY DATE(created_at) ORDER BY date"
      },
      {
        "type": "chart",
        "title": "Объявления по статусам",
        "chart_type": "pie", 
        "query": "SELECT status, COUNT(*) as count FROM car_listings GROUP BY status"
      },
      {
        "type": "chart",
        "title": "Топ марок автомобилей",
        "chart_type": "bar",
        "query": "SELECT make, COUNT(*) as count FROM car_listings WHERE status IN ('active', 'ended') GROUP BY make ORDER BY count DESC LIMIT 10"
      },
      {
        "type": "chart",
        "title": "Продажи по дням",
        "chart_type": "line",
        "query": "SELECT DATE(auction_end_time) as date, COUNT(*) as sales, COALESCE(SUM(CAST(current_bid as decimal)), 0) as revenue FROM car_listings WHERE status = 'ended' AND current_bid IS NOT NULL AND auction_end_time >= CURRENT_DATE - INTERVAL '30 days' GROUP BY DATE(auction_end_time) ORDER BY date"
      }
    ]
  },
  "automations": [
    {
      "name": "Автоодобрение проверенных продавцов",
      "trigger": {
        "table": "car_listings",
        "event": "insert"
      },
      "conditions": [
        {
          "field": "seller_id",
          "operator": "in", 
          "value": "verified_sellers_list"
        }
      ],
      "actions": [
        {
          "type": "update_record",
          "fields": {"status": "active", "auction_start_time": "NOW()"}
        }
      ]
    },
    {
      "name": "Уведомление об истечении аукциона",
      "trigger": {
        "type": "scheduled",
        "schedule": "*/5 * * * *"
      },
      "conditions": [
        {
          "query": "SELECT * FROM car_listings WHERE status = 'active' AND auction_end_time <= NOW() + INTERVAL '1 hour'"
        }
      ],
      "actions": [
        {
          "type": "create_notification",
          "template": "Аукцион {{lot_number}} завершается через час"
        }
      ]
    }
  ],
  "user_roles": [
    {
      "name": "Super Admin",
      "permissions": {
        "*": ["create", "read", "update", "delete", "admin"]
      }
    },
    {
      "name": "Moderator",
      "permissions": {
        "users": ["read", "update"],
        "car_listings": ["read", "update"],
        "bids": ["read"],
        "notifications": ["create", "read", "update"],
        "favorites": ["read"],
        "car_alerts": ["read"]
      }
    },
    {
      "name": "Analyst", 
      "permissions": {
        "*": ["read"]
      }
    }
  ],
  "quick_actions": [
    {
      "name": "Одобрить объявление",
      "table": "car_listings",
      "conditions": [{"field": "status", "value": "pending"}],
      "actions": [
        {"field": "status", "value": "active"},
        {"field": "auction_start_time", "value": "NOW()"},
        {"field": "auction_end_time", "value": "NOW() + INTERVAL auction_duration HOUR"}
      ]
    },
    {
      "name": "Отклонить объявление",
      "table": "car_listings", 
      "conditions": [{"field": "status", "value": "pending"}],
      "actions": [
        {"field": "status", "value": "rejected"}
      ]
    },
    {
      "name": "Активировать пользователя",
      "table": "users",
      "conditions": [{"field": "is_active", "value": false}],
      "actions": [
        {"field": "is_active", "value": true}
      ]
    },
    {
      "name": "Деактивировать пользователя", 
      "table": "users",
      "conditions": [{"field": "is_active", "value": true}],
      "actions": [
        {"field": "is_active", "value": false}
      ]
    }
  ],
  "reports": [
    {
      "name": "Ежедневный отчет модератора",
      "description": "Сводка для утренней проверки",
      "query": "SELECT 'Новые объявления' as metric, COUNT(*) as value FROM car_listings WHERE status = 'pending' AND created_at >= CURRENT_DATE - INTERVAL '1 day' UNION ALL SELECT 'Новые пользователи', COUNT(*) FROM users WHERE is_active = false AND created_at >= CURRENT_DATE - INTERVAL '1 day' UNION ALL SELECT 'Активные аукционы', COUNT(*) FROM car_listings WHERE status = 'active'"
    },
    {
      "name": "Еженедельная статистика продаж",
      "description": "Анализ результатов за неделю",
      "query": "SELECT make, COUNT(*) as listings, AVG(CAST(COALESCE(current_bid, starting_price) as decimal)) as avg_price, SUM(CAST(COALESCE(current_bid, starting_price) as decimal)) as total_value FROM car_listings WHERE created_at >= CURRENT_DATE - INTERVAL '7 days' GROUP BY make ORDER BY total_value DESC"
    },
    {
      "name": "Топ продавцов месяца",
      "description": "Рейтинг продавцов по объему продаж",
      "query": "SELECT u.username, u.full_name, COUNT(cl.id) as listings_count, SUM(CAST(COALESCE(cl.current_bid, cl.starting_price) as decimal)) as total_value FROM users u JOIN car_listings cl ON u.id = cl.seller_id WHERE cl.created_at >= CURRENT_DATE - INTERVAL '30 days' GROUP BY u.id, u.username, u.full_name ORDER BY total_value DESC LIMIT 20"
    }
  ],
  "export_configs": [
    {
      "name": "Пользователи для бухгалтерии",
      "table": "users",
      "format": "excel",
      "columns": ["username", "full_name", "phone_number", "created_at", "is_active"],
      "filters": [{"field": "role", "operator": "in", "value": ["seller", "buyer"]}]
    },
    {
      "name": "Продажи для налоговой",
      "query": "SELECT cl.lot_number, cl.make, cl.model, cl.year, u.full_name as seller, cl.starting_price, cl.current_bid, cl.auction_end_time FROM car_listings cl JOIN users u ON cl.seller_id = u.id WHERE cl.status = 'ended' AND cl.auction_end_time >= CURRENT_DATE - INTERVAL '1 month'",
      "format": "excel"
    }
  ]
}