# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –ü–û–†–¢–û–ú 3001

# –ü–æ—Ä—Ç 3001 —É–∂–µ –∑–∞–Ω—è—Ç. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ VPS:

# 1. –ù–∞–π—Ç–∏ –∏ —É–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç—É 3001
lsof -ti:3001 | xargs kill -9

# 2. –ò–ª–∏ —É–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã node
pkill -f node

# 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É–∂–±—É autobid
systemctl stop autobid

# 4. –ü–æ–¥–æ–∂–¥–∞—Ç—å 3 —Å–µ–∫—É–Ω–¥—ã
sleep 3

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω
lsof -i:3001 || echo "–ü–æ—Ä—Ç 3001 —Å–≤–æ–±–æ–¥–µ–Ω"

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É —Å–Ω–æ–≤–∞
systemctl start autobid

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status autobid

# 8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
curl -s http://localhost:3001/health || echo "–ù–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

# 9. –ï—Å–ª–∏ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL
if curl -s http://localhost:3001/health; then
    echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PostgreSQL..."
    apt update
    DEBIAN_FRONTEND=noninteractive apt install -y postgresql postgresql-contrib
    systemctl start postgresql
    systemctl enable postgresql
    sudo -u postgres createdb autobid_db
    sudo -u postgres createuser autobid_user
    sudo -u postgres psql -c "ALTER USER autobid_user WITH PASSWORD 'AutoBid2025';"
    sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE autobid_db TO autobid_user;"
    echo "üéâ –ì–û–¢–û–í–û! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞!"
else
    echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è"
fi