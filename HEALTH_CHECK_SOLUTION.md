# Health Check Fix - DigitalOcean Deployment (–ê–≤–≥—É—Å—Ç 2025)

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º —Å–±–æ—Ä–∫–∏ Docker, –≤–æ–∑–Ω–∏–∫–ª–∞ –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞:
```
ERROR failed health checks after 14 attempts with error Readiness probe failed: 
dial tcp 10.244.65.249:8080: connect: connection refused
```

## –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ. Health check –Ω–∞ –ø–æ—Ä—Ç—É 8080 –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ production.ts
```typescript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—Ç)
setTimeout(() => {
  try {
    ImageUpdateService.initializeOnStartup();
    console.log("‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–ø—É—â–µ–Ω–∞");
  } catch (err) {
    console.log("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:", err);
  }
}, 5000); // –ó–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ health check
```typescript
app.get('/health', (req, res) => {
  console.log('üè• Health check –∑–∞–ø—Ä–æ—à–µ–Ω');
  res.status(200).json({ 
    status: 'OK', 
    timestamp: new Date().toISOString(),
    env: process.env.NODE_ENV || 'development',
    port: process.env.PORT || '8080'
  });
});
```

### 3. Fallback –¥–ª—è registerRoutes
```typescript
let server;
try {
  server = await registerRoutes(app);
  console.log("‚úÖ API —Ä–æ—É—Ç—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ");
} catch (error) {
  console.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ API —Ä–æ—É—Ç–æ–≤:", error);
  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π HTTP server –µ—Å–ª–∏ registerRoutes –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
  const http = await import('http');
  server = http.createServer(app);
  console.log("‚úÖ –°–æ–∑–¥–∞–Ω –±–∞–∑–æ–≤—ã–π HTTP —Å–µ—Ä–≤–µ—Ä");
}
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `DATABASE_URL` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –ë–î
- –î—Ä—É–≥–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å dependencies
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç runtime –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π Node.js

### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ DigitalOcean
```bash
# –í –∫–æ–Ω—Å–æ–ª–∏ DigitalOcean App Platform
doctl apps logs <app-id>
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å Docker
```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
docker build -t autobid-test .
docker run -p 8080:8080 -e NODE_ENV=production autobid-test
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
DATABASE_URL=postgresql://user:pass@host:port/db
SESSION_SECRET=some-secret-key
NODE_ENV=production
PORT=8080
```

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π production.ts

–°–æ–∑–¥–∞–Ω–∞ –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤–∞—è –≤–µ—Ä—Å–∏—è production.ts —Å:
- ‚úÖ –õ—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏  
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ç—è–∂–µ–ª—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## –°—Ç–∞—Ç—É—Å
‚ö†Ô∏è **–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê** - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è –≤ DigitalOcean –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã –ø–∞–¥–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.