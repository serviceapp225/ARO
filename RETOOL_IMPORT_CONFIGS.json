{
  "app_config": {
    "name": "AutoBid Admin Panel",
    "description": "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π AutoBid.tj",
    "theme": "default"
  },
  "queries": [
    {
      "name": "getStats",
      "type": "postgresql",
      "query": "SELECT (SELECT COUNT(*) FROM car_listings WHERE status = 'pending') as pending_listings, (SELECT COUNT(*) FROM car_listings WHERE status = 'active') as active_auctions, (SELECT COUNT(*) FROM users) as total_users, (SELECT COUNT(*) FROM users WHERE is_active = false) as banned_users, (SELECT COUNT(*) FROM bids WHERE created_at >= CURRENT_DATE) as todays_bids, (SELECT COALESCE(SUM(CAST(current_bid as decimal)), 0) FROM car_listings WHERE status = 'ended' AND current_bid IS NOT NULL) as total_sales",
      "runOnPageLoad": true,
      "autoRefresh": 30000
    },
    {
      "name": "getUsers",
      "type": "postgresql", 
      "query": "SELECT id, username, email, full_name, role, is_active, created_at, (SELECT COUNT(*) FROM car_listings WHERE seller_id = users.id) as listings_count, (SELECT COUNT(*) FROM bids WHERE bidder_id = users.id) as bids_count FROM users ORDER BY created_at DESC",
      "runOnPageLoad": true
    },
    {
      "name": "getPendingListings",
      "type": "postgresql",
      "query": "SELECT cl.id, cl.lot_number, cl.make, cl.model, cl.year, cl.mileage, cl.starting_price, cl.description, cl.status, cl.created_at, u.username as seller_name, u.email as seller_email FROM car_listings cl JOIN users u ON cl.seller_id = u.id WHERE cl.status = 'pending' ORDER BY cl.created_at ASC",
      "runOnPageLoad": true
    },
    {
      "name": "getAllListings", 
      "type": "postgresql",
      "query": "SELECT cl.id, cl.lot_number, cl.make, cl.model, cl.year, cl.starting_price, cl.current_bid, cl.status, cl.created_at, cl.auction_end_time, u.username as seller_name, (SELECT COUNT(*) FROM bids WHERE listing_id = cl.id) as bids_count FROM car_listings cl JOIN users u ON cl.seller_id = u.id ORDER BY cl.created_at DESC LIMIT 100",
      "runOnPageLoad": true
    },
    {
      "name": "updateUserStatus",
      "type": "postgresql",
      "query": "UPDATE users SET is_active = {{ !usersTable.selectedRow.is_active }} WHERE id = {{ usersTable.selectedRow.id }}",
      "onSuccess": ["getUsers", "getStats"]
    },
    {
      "name": "approveListing",
      "type": "postgresql", 
      "query": "UPDATE car_listings SET status = 'active', auction_start_time = NOW(), auction_end_time = NOW() + INTERVAL '72 hours' WHERE id = {{ pendingListingsTable.selectedRow.id }}",
      "onSuccess": ["getPendingListings", "getAllListings", "getStats"]
    },
    {
      "name": "rejectListing",
      "type": "postgresql",
      "query": "UPDATE car_listings SET status = 'rejected' WHERE id = {{ pendingListingsTable.selectedRow.id }}",
      "onSuccess": ["getPendingListings", "getAllListings", "getStats"]
    },
    {
      "name": "getRegistrationChart",
      "type": "postgresql",
      "query": "SELECT DATE(created_at) as date, COUNT(*) as registrations FROM users WHERE created_at >= CURRENT_DATE - INTERVAL '30 days' GROUP BY DATE(created_at) ORDER BY date"
    },
    {
      "name": "getSalesChart", 
      "type": "postgresql",
      "query": "SELECT DATE(auction_end_time) as date, COUNT(*) as sales, COALESCE(SUM(CAST(current_bid as decimal)), 0) as revenue FROM car_listings WHERE status = 'ended' AND current_bid IS NOT NULL AND auction_end_time >= CURRENT_DATE - INTERVAL '30 days' GROUP BY DATE(auction_end_time) ORDER BY date"
    },
    {
      "name": "getTopBrands",
      "type": "postgresql",
      "query": "SELECT make, COUNT(*) as count, COALESCE(AVG(CAST(current_bid as decimal)), 0) as avg_price FROM car_listings WHERE status IN ('active', 'ended') GROUP BY make ORDER BY count DESC LIMIT 10"
    }
  ],
  "components": [
    {
      "type": "tabs",
      "name": "mainTabs",
      "tabs": [
        {
          "label": "Dashboard",
          "key": "dashboard"
        },
        {
          "label": "Users", 
          "key": "users"
        },
        {
          "label": "Listings",
          "key": "listings"
        },
        {
          "label": "Analytics",
          "key": "analytics"
        }
      ]
    },
    {
      "type": "container",
      "name": "dashboardTab",
      "showIf": "{{ mainTabs.value === 'dashboard' }}",
      "components": [
        {
          "type": "text",
          "text": "# AutoBid.tj Admin Dashboard",
          "style": {
            "fontSize": "24px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        {
          "type": "container",
          "style": {
            "display": "grid",
            "gridTemplateColumns": "repeat(3, 1fr)",
            "gap": "20px",
            "marginBottom": "30px"
          },
          "components": [
            {
              "type": "statistic",
              "name": "pendingStat",
              "label": "–û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏",
              "value": "{{ getStats.data?.[0]?.pending_listings || 0 }}",
              "color": "orange",
              "icon": "clock"
            },
            {
              "type": "statistic", 
              "name": "activeStat",
              "label": "–ê–∫—Ç–∏–≤–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã",
              "value": "{{ getStats.data?.[0]?.active_auctions || 0 }}",
              "color": "green",
              "icon": "trending-up"
            },
            {
              "type": "statistic",
              "name": "usersStat", 
              "label": "–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
              "value": "{{ getStats.data?.[0]?.total_users || 0 }}",
              "color": "blue",
              "icon": "users"
            },
            {
              "type": "statistic",
              "name": "bannedStat",
              "label": "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ",
              "value": "{{ getStats.data?.[0]?.banned_users || 0 }}",
              "color": "red", 
              "icon": "user-x"
            },
            {
              "type": "statistic",
              "name": "bidsStat",
              "label": "–°—Ç–∞–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è",
              "value": "{{ getStats.data?.[0]?.todays_bids || 0 }}",
              "color": "purple",
              "icon": "zap"
            },
            {
              "type": "statistic",
              "name": "salesStat",
              "label": "–û–±—â–∏–π –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂",
              "value": "${{ (getStats.data?.[0]?.total_sales || 0).toLocaleString() }}",
              "color": "green",
              "icon": "dollar-sign"
            }
          ]
        },
        {
          "type": "container",
          "style": {
            "display": "flex",
            "gap": "10px",
            "marginBottom": "20px"
          },
          "components": [
            {
              "type": "button",
              "text": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
              "color": "blue",
              "onClick": [
                {
                  "action": "trigger",
                  "query": "getStats"
                }
              ]
            },
            {
              "type": "button", 
              "text": "–ú–æ–¥–µ—Ä–∞—Ü–∏—è ({{ getStats.data?.[0]?.pending_listings || 0 }})",
              "color": "orange",
              "onClick": [
                {
                  "action": "setTab",
                  "tab": "listings"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "container",
      "name": "usersTab",
      "showIf": "{{ mainTabs.value === 'users' }}",
      "components": [
        {
          "type": "text",
          "text": "# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",
          "style": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        {
          "type": "container",
          "style": {
            "display": "flex",
            "gap": "10px",
            "marginBottom": "20px"
          },
          "components": [
            {
              "type": "button",
              "name": "toggleUserBtn",
              "text": "{{ usersTable.selectedRow ? (usersTable.selectedRow.is_active ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å' : '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å') : '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }}",
              "color": "{{ usersTable.selectedRow?.is_active ? 'red' : 'green' }}",
              "disabled": "{{ !usersTable.selectedRow }}",
              "onClick": [
                {
                  "action": "trigger",
                  "query": "updateUserStatus"
                }
              ]
            },
            {
              "type": "button",
              "text": "–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫",
              "color": "blue",
              "onClick": [
                {
                  "action": "trigger", 
                  "query": "getUsers"
                }
              ]
            }
          ]
        },
        {
          "type": "table",
          "name": "usersTable",
          "data": "{{ getUsers.data }}",
          "columns": [
            {
              "key": "id",
              "label": "ID",
              "width": "60px"
            },
            {
              "key": "username", 
              "label": "Username"
            },
            {
              "key": "email",
              "label": "Email" 
            },
            {
              "key": "full_name",
              "label": "–ò–º—è"
            },
            {
              "key": "is_active",
              "label": "–°—Ç–∞—Ç—É—Å",
              "render": "{{ value ? 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' }}"
            },
            {
              "key": "role", 
              "label": "–†–æ–ª—å"
            },
            {
              "key": "listings_count",
              "label": "–û–±—ä—è–≤–ª–µ–Ω–∏–π",
              "width": "100px"
            },
            {
              "key": "bids_count",
              "label": "–°—Ç–∞–≤–æ–∫",
              "width": "80px"
            },
            {
              "key": "created_at",
              "label": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
              "type": "datetime",
              "format": "DD.MM.YYYY HH:mm"
            }
          ],
          "searchable": true,
          "sortable": true,
          "pagination": true,
          "pageSize": 20
        }
      ]
    },
    {
      "type": "container",
      "name": "listingsTab", 
      "showIf": "{{ mainTabs.value === 'listings' }}",
      "components": [
        {
          "type": "text",
          "text": "# –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π",
          "style": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        {
          "type": "text",
          "text": "## –û–∂–∏–¥–∞—é—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ({{ getPendingListings.data?.length || 0 }})",
          "style": {
            "fontSize": "16px",
            "fontWeight": "bold",
            "marginBottom": "10px",
            "color": "orange"
          }
        },
        {
          "type": "container",
          "style": {
            "display": "flex",
            "gap": "10px", 
            "marginBottom": "20px"
          },
          "components": [
            {
              "type": "button",
              "name": "approveBtn",
              "text": "‚úÖ –û–¥–æ–±—Ä–∏—Ç—å",
              "color": "green",
              "disabled": "{{ !pendingListingsTable.selectedRow }}",
              "onClick": [
                {
                  "action": "trigger",
                  "query": "approveListing"
                }
              ]
            },
            {
              "type": "button",
              "name": "rejectBtn", 
              "text": "‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å",
              "color": "red",
              "disabled": "{{ !pendingListingsTable.selectedRow }}",
              "onClick": [
                {
                  "action": "trigger",
                  "query": "rejectListing"
                }
              ]
            },
            {
              "type": "button",
              "text": "–û–±–Ω–æ–≤–∏—Ç—å",
              "color": "blue",
              "onClick": [
                {
                  "action": "trigger",
                  "query": "getPendingListings"
                }
              ]
            }
          ]
        },
        {
          "type": "table",
          "name": "pendingListingsTable",
          "data": "{{ getPendingListings.data }}",
          "columns": [
            {
              "key": "lot_number",
              "label": "–õ–æ—Ç",
              "width": "100px"
            },
            {
              "key": "make",
              "label": "–ú–∞—Ä–∫–∞"
            },
            {
              "key": "model",
              "label": "–ú–æ–¥–µ–ª—å"
            },
            {
              "key": "year",
              "label": "–ì–æ–¥",
              "width": "70px"
            },
            {
              "key": "mileage",
              "label": "–ü—Ä–æ–±–µ–≥",
              "render": "{{ value?.toLocaleString() }} –∫–º"
            },
            {
              "key": "starting_price",
              "label": "–¶–µ–Ω–∞",
              "render": "${{ value }}"
            },
            {
              "key": "seller_name",
              "label": "–ü—Ä–æ–¥–∞–≤–µ—Ü"
            },
            {
              "key": "created_at",
              "label": "–°–æ–∑–¥–∞–Ω–æ",
              "type": "datetime",
              "format": "DD.MM HH:mm"
            }
          ],
          "searchable": true,
          "sortable": true
        },
        {
          "type": "text",
          "text": "## –í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
          "style": {
            "fontSize": "16px",
            "fontWeight": "bold",
            "marginTop": "40px",
            "marginBottom": "10px"
          }
        },
        {
          "type": "table",
          "name": "allListingsTable", 
          "data": "{{ getAllListings.data }}",
          "columns": [
            {
              "key": "lot_number",
              "label": "–õ–æ—Ç",
              "width": "100px"
            },
            {
              "key": "make",
              "label": "–ú–∞—Ä–∫–∞"
            },
            {
              "key": "model", 
              "label": "–ú–æ–¥–µ–ª—å"
            },
            {
              "key": "status",
              "label": "–°—Ç–∞—Ç—É—Å",
              "render": "{{ value === 'pending' ? 'üü° –ú–æ–¥–µ—Ä–∞—Ü–∏—è' : value === 'active' ? 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' : value === 'ended' ? '‚ö´ –ó–∞–≤–µ—Ä—à–µ–Ω' : 'üî¥ –û—Ç–∫–ª–æ–Ω–µ–Ω' }}"
            },
            {
              "key": "current_bid",
              "label": "–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞",
              "render": "{{ value ? `$${value}` : '–ù–µ—Ç —Å—Ç–∞–≤–æ–∫' }}"
            },
            {
              "key": "bids_count",
              "label": "–°—Ç–∞–≤–æ–∫",
              "width": "80px"
            },
            {
              "key": "seller_name",
              "label": "–ü—Ä–æ–¥–∞–≤–µ—Ü"
            }
          ],
          "searchable": true,
          "sortable": true,
          "pagination": true,
          "pageSize": 20
        }
      ]
    },
    {
      "type": "container",
      "name": "analyticsTab",
      "showIf": "{{ mainTabs.value === 'analytics' }}",
      "components": [
        {
          "type": "text",
          "text": "# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
          "style": {
            "fontSize": "20px",
            "fontWeight": "bold",
            "marginBottom": "20px"
          }
        },
        {
          "type": "container",
          "style": {
            "display": "grid",
            "gridTemplateColumns": "1fr 1fr",
            "gap": "20px",
            "marginBottom": "30px"
          },
          "components": [
            {
              "type": "chart",
              "name": "registrationChart",
              "title": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞ –º–µ—Å—è—Ü",
              "data": "{{ getRegistrationChart.data }}",
              "chartType": "line",
              "xAxis": "date",
              "yAxis": "registrations"
            },
            {
              "type": "chart",
              "name": "salesChart", 
              "title": "–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –º–µ—Å—è—Ü",
              "data": "{{ getSalesChart.data }}",
              "chartType": "bar",
              "xAxis": "date",
              "yAxis": "revenue"
            }
          ]
        },
        {
          "type": "table",
          "name": "topBrandsTable",
          "title": "–¢–æ–ø –º–∞—Ä–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π",
          "data": "{{ getTopBrands.data }}",
          "columns": [
            {
              "key": "make",
              "label": "–ú–∞—Ä–∫–∞"
            },
            {
              "key": "count",
              "label": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"
            },
            {
              "key": "avg_price",
              "label": "–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞",
              "render": "${{ Math.round(value) }}"
            }
          ]
        }
      ]
    }
  ]
}